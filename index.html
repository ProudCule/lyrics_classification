<doctype !html>
<head>
  <title>CS 221 Project - Autumn 2016 - Stanford University - Dhruv Joshi </title>
  <link rel='stylesheet' type='text/css' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css'>
</head>
<body>
  <nav class="navbar navbar-default">
    <div class="navbar-header">
      <a class="navbar-brand">DHRUV JOSHI</a>
      <a class="navbar-brand">Stanford Fall 2016 CS 221 Project</a>
    </div>
  </nav>
	<div class="container-fluid">
	  <div class="page-header">
	  	<h1 class="h1">Lyrics-based classification of Songs</h1>
	  </div>
	  <form id="lyrics_form" class="col-lg-12">
	  	<div class="form-group">
		  	<textarea type="text" name="lyrix" class="form-control" placeholder="Please enter song lyrics. Max 5000 chars." maxlength="5000" id="lyrix" width="100% !important"></textarea>
		</div>
		<button type="submit" class="btn btn-default">Process!</button>
	  </form>
	  <div id="prediction">
	  	Predicted genre for this song:
	  </div>
	  <div style="padding:10px">
	  	Probabilities of each genre:
		  <table class="table table-bordered" id='gprobs'>
		  	<tr>
			  	<th>Rock</th>
			  	<th>Pop</th>
			  	<th>Hop Hop/Rap</th>
			  	<th>R&B</th>
			  	<th>Country</th>
			  	<th>Jazz</th>
			  	<th>Blues</th>
			  	<th>Christian</th>
			 </tr>
		  </table>
		</div>
	</div>
</body>
<script src="https://code.jquery.com/jquery-2.2.4.min.js"
			  integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
			  		crossorigin="anonymous"></script>
<script>
$("#lyrics_form").submit(function (e){
	e.preventDefault();
	processLyrics();
})

// a lookup table for genres
var genre = {
  "0": function() {
    return "Rock";
  },
  "1": function() {
    return "Pop";
  },
  "2":  function() {
    return "Hip Hop/Rap";
  },
  "3": function() {
    return "R&B";
  },
  "4": function() {
    return "Country";
  },
  "5": function() {
    return "Jazz";
  },
  "6": function() {
    return "Blues";
  },
  "7": function() {
    return "Christian";
  },
};

function processLyrics() {
	var user_lyrics = $("#lyrix").val();
	// console.log(user_lyrics);
	// https://api.jquery.com/jquery.post/
	$.post( "/process-lyrics", { lyrics: user_lyrics } , function(data) {
		// generate a table showing probabilities of different genres, RID and others
		// console.log(data.prediction);
		var predicted_genre = data.prediction
		var topngrams = data.topngrams
		var topwords = data.topwords
		var probabilities = data.probabilities

		// console.log(probabilities)
		$('#prediction').append(genre[predicted_genre]())

		// write to the table
		var new_row = '<tr>';
		for (i=0; i<8; i++) {
			new_row += '<td>' + probabilities[i] + '</td>'
		}
		new_row += '</tr>';
		$('#gprobs').append(new_row)
	});
}

</script>
